<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador Numérico Cyberpunk</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilos base */
        body { 
            font-family: 'Poppins', sans-serif;
            background-color: #0a0a0a; /* Fondo ultra oscuro */
            color: #e0e0e0; /* Texto principal gris claro */
            overflow-x: hidden; /* Evitar scroll horizontal por los blur */
        }
        
        /* Efecto de fondo sutil con blur */
        .neon-bg-glow {
            animation: pulseGlow 10s infinite alternate;
        }

        @keyframes pulseGlow {
            0% { transform: scale(1); opacity: 0.2; }
            50% { transform: scale(1.05); opacity: 0.3; }
            100% { transform: scale(1); opacity: 0.2; }
        }

        /* Estilos de tarjetas y elementos */
        .card-neon {
            background-color: #1a1a1a; /* Fondo de tarjetas oscuro */
            border: 1px solid #2e2e2e; /* Borde oscuro sutil */
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.05); /* Sombra sutil verde neón */
            transition: all 0.3s ease-in-out;
        }
        .card-neon:hover {
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.15); /* Sombra más intensa al hover */
        }

        /* Animaciones */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .slide-in { animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Scrollbar personalizado */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1a1a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #00ff41; border-radius: 4px; box-shadow: 0 0 5px rgba(0, 255, 65, 0.5); }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #00e03a; }

        /* Clases Tabs Estilo Neon Green */
        .active-tab-neon { 
            background: #00ff41; /* Verde Neón puro */
            color: #0a0a0a; /* Texto oscuro para contraste */
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.7); /* Glow neón */
            transform: translateY(-2px);
            border-color: #00e03a;
        }
        .inactive-tab-neon { 
            background-color: #2e2e2e; 
            color: #90ee90; /* Verde claro para inactivos */
            border: 1px solid #4a4a4a;
        }
        .inactive-tab-neon:hover { 
            background-color: #4a4a4a; 
            color: #00ff41; 
            border-color: #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
        }

        /* Gradiante para resaltar resultados clave (Neón, mezcla de verde y cian) */
        .highlight-neon-gradient {
            background: linear-gradient(90deg, #00ff41 0%, #00ffff 100%); /* Verde Neón a Cian Eléctrico */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Clases para efectos Neón en las tarjetas de resultados */
        .best-method-card {
            border: 2px solid #00ff41; /* Púrpura neón intenso para el óptimo */
            box-shadow: 0 0 15px #ff00ff, inset 0 0 8px #ff00ff80;
            background-color: #2a002a; /* Fondo púrpura muy oscuro */
        }
        .best-badge-neon {
            background-color: #ff00ff; /* Púrpura Neón */
            color: #1a1a1a;
            text-shadow: 0 0 5px #0a0a0a;
        }

        /* Botón de acción con efecto neón */
        .neon-button {
            background: linear-gradient(90deg, #00ff41 0%, #00ffff 100%);
            color: #0a0a0a;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
            transition: all 0.3s ease-in-out;
        }
        .neon-button:hover {
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.8), 0 0 30px rgba(0, 255, 255, 0.6);
            transform: scale(1.02);
            filter: brightness(1.2);
        }
        .neon-button:active {
            transform: scale(0.98);
            filter: brightness(0.8);
        }

        /* Inputs y Selects */
        .neon-input {
            background-color: #1a1a1a;
            border: 1px solid #00ff41;
            color: #00ff41;
            box-shadow: 0 0 5px rgba(0, 255, 65, 0.3);
            font-family: 'Roboto Mono', monospace;
        }
        .neon-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
        }
    </style>
</head>
<body class="min-h-screen custom-scrollbar">

    <div class="fixed inset-0 -z-10 overflow-hidden">
        <div class="absolute inset-0 bg-black bg-[radial-gradient(#1a1a1a_1px,transparent_1px)] [background-size:16px_16px]"></div>
        <div class="absolute -top-[5%] -left-[5%] w-1/4 h-1/4 rounded-full bg-[#00ff41] blur-[150px] opacity-20 neon-bg-glow"></div>
        <div class="absolute bottom-[10%] -right-[5%] w-1/3 h-1/3 rounded-full bg-[#00ffff] blur-[150px] opacity-20 neon-bg-glow" style="animation-delay: 2s;"></div>
        <div class="absolute top-[20%] right-[10%] w-1/5 h-1/5 rounded-full bg-[#ff00ff] blur-[150px] opacity-15 neon-bg-glow" style="animation-delay: 4s;"></div>
    </div>

    <div class="max-w-7xl mx-auto p-4 md:p-8 relative z-10">
        
        <header class="text-center mb-10 fade-in">
            <div class="inline-flex items-center justify-center p-3 card-neon rounded-xl mb-4">
                <i data-lucide="calculator" class="w-8 h-8 text-[#00ff41] mr-3"></i>
                <h1 class="text-3xl md:text-4xl font-extrabold text-transparent highlight-neon-gradient">
                    DESAFIO RAICES DE ECUACIONES
                </h1>
            </div>
            <p class="text-green-400 font-medium font-mono text-sm tracking-widest uppercase">Métodos Numéricos BISECCION, NEWTON RAPHSON, SECANTE</p>
        </header>

        <div id="tabs-container" class="flex flex-wrap gap-3 justify-center mb-8 sticky top-4 z-20 backdrop-blur-md bg-gray-950/80 p-3 rounded-xl border border-gray-800 mx-auto max-w-fit shadow-2xl"></div>

                <div class="grid grid-cols-1 lg:grid-cols-12">
            <div class="lg:col-span-6 lg:col-start-4 space-y-6 slide-in" style="animation-delay: 0.1s;">
                <div class="card-neon rounded-xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 bg-[#00ff41] rounded-bl-xl shadow-lg shadow-[#00ff41]/30">
                        <i data-lucide="code-square" class="w-5 h-5 text-black"></i>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-white mb-1" id="ex-title">Cargando...</h2>
                    <p id="ex-desc" class="text-sm text-green-300 mb-6">...</p>
                    
                    <div class="bg-gray-900 p-4 rounded-lg mb-6 border border-gray-700 shadow-inner shadow-green-900/20">
                        <p class="text-xs text-gray-500 mb-2 uppercase tracking-wider font-bold">Función f(x)</p>
                        <code id="ex-equation" class="text-xl font-bold text-[#00ffff] block break-words font-mono">...</code>
                    </div>

                    <div class="space-y-4 mb-8">
                        <p class="text-base font-bold text-gray-200 flex items-center gap-2">
                            <i data-lucide="target" class="w-5 h-5 text-[#00ff41]"></i> Objetivos y Parámetros
                        </p>
                        <div id="configs-container" class="space-y-3"></div>
                    </div>

                    <button id="btn-calculate" onclick="calculateCurrent()" class="group w-full relative overflow-hidden rounded-lg text-black font-bold text-lg neon-button disabled:opacity-50 disabled:cursor-not-allowed">
                        <div class="relative px-6 py-4 flex items-center justify-center gap-3">
                            <i data-lucide="cpu" class="w-5 h-5 btn-icon text-black"></i>
                            <span class="btn-text">Resolver</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>

                <div id="results-area" class="mt-12 pt-8 border-t border-gray-800">
            <div id="empty-state" class="h-full min-h-[300px] flex flex-col items-center justify-center card-neon rounded-xl border-2 border-dashed border-gray-700 text-center p-8 fade-in shadow-green-900/10">
                <div class="w-24 h-24 bg-gray-900 rounded-full flex items-center justify-center mb-6 shadow-xl border border-gray-800">
                    <i data-lucide="scatter-chart" class="w-10 h-10 text-gray-600"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-300 mb-2">Resultados en Espera</h3>
                <p class="text-gray-500 max-w-xs mx-auto">Selecciona un ejercicio y presiona "Ejecutar Métodos" para iniciar el análisis.</p>
            </div>

            <div id="results-content" class="hidden space-y-8">
                <div class="card-neon rounded-xl p-6 slide-in">
                    <div class="flex items-center justify-between mb-6 border-b border-gray-800 pb-3">
                        <h3 class="text-xl font-bold text-white flex items-center gap-3">
                            <i data-lucide="bar-chart-3" class="w-5 h-5 text-[#00ff41]"></i> Gràfica
                        </h3>
                        <div class="flex gap-4 text-xs font-medium text-gray-400">
                            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-yellow-400 shadow-md shadow-yellow-400/50"></span> f(x)</span>
                            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-red-500 shadow-md shadow-red-500/50"></span> Raíces</span>
                        </div>
                    </div>
                    <div class="h-[400px] w-full relative">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
                
                <div id="cards-container" class="grid gap-6"></div>
            </div>
        </div>
    </div>

    <div id="table-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-950/80 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-xl card-neon text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-5xl border border-gray-700">
                    <div class="bg-gray-900 px-6 py-4 border-b border-gray-800 flex justify-between items-center sticky top-0">
                        <div>
                            <h3 class="text-xl font-bold text-white" id="modal-title">Tabla de Iteraciones</h3>
                            <p class="text-sm text-gray-400" id="modal-subtitle">Método</p>
                        </div>
                        <button onclick="closeModal()" class="rounded-full p-2 bg-gray-700 hover:bg-gray-600 text-[#00ff41] transition-colors hover:shadow-md hover:shadow-[#00ff41]/30">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="px-6 py-6 max-h-[70vh] overflow-auto custom-scrollbar">
                        <table class="min-w-full divide-y divide-gray-800 text-sm">
                            <thead class="bg-gray-800 font-sans">
                                <tr>
                                    <th class="px-4 py-3 text-left font-bold text-gray-300 uppercase tracking-wider">Iter</th>
                                    <th class="px-4 py-3 text-left font-bold text-gray-300 uppercase tracking-wider">x (Raíz Aprox)</th>
                                    <th class="px-4 py-3 text-left font-bold text-gray-300 uppercase tracking-wider">f(x)</th>
                                    <th class="px-4 py-3 text-left font-bold text-gray-300 uppercase tracking-wider">Error |x_k+1 - x_k|</th>
                                </tr>
                            </thead>
                            <tbody id="modal-table-body" class="bg-gray-900 divide-y divide-gray-800 font-mono text-xs md:text-sm"></tbody>
                        </table>
                    </div>
                    <div class="bg-gray-900 px-6 py-3 border-t border-gray-800 text-right">
                        <button onclick="closeModal()" class="inline-flex justify-center rounded-lg bg-[#00ff41] px-4 py-2 text-sm font-medium text-black neon-button">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- LÓGICA MATEMÁTICA (MANTENIDA) ---
        let activeTab = 0;
        let chartInstance = null;
        let currentResults = null;

        const exercises = [
            {
                id: 1,
                title: "Ejercicio 1",
                equation: "x³ - e^(0.8x) - 20 = 0",
                description: "Polinomio vs Exponencial (2 Raíces)",
                f: (x) => Math.pow(x, 3) - Math.exp(0.8 * x) - 20,
                df: (x) => 3 * Math.pow(x, 2) - 0.8 * Math.exp(0.8 * x),
                graphRange: { min: 0, max: 8.5 },
                configs: [
                    { name: "Primera Raíz", interval: [0, 5], x0Newton: 3, x0Secant: 3, x1Secant: 4 },
                    { name: "Segunda Raíz", interval: [6, 8], x0Newton: 7, x0Secant: 7, x1Secant: 8 }
                ]
            },
            {
                id: 2,
                title: "Ejercicio 2",
                equation: "3sin(0.5x) - 0.5x + 2 = 0",
                description: "Trigonométrica con lineal",
                f: (x) => 3 * Math.sin(0.5 * x) - 0.5 * x + 2,
                df: (x) => 1.5 * Math.cos(0.5 * x) - 0.5,
                graphRange: { min: 0, max: 10 },
                configs: [
                    { name: "Raíz Principal", interval: [4, 8], x0Newton: 5, x0Secant: 5, x1Secant: 6 }
                ]
            },
            {
                id: 3,
                title: "Ejercicio 3",
                equation: "x³ - x²e^(-0.5x) - 3x + 1 = 0",
                description: "Polinomio complejo",
                f: (x) => Math.pow(x, 3) - Math.pow(x, 2) * Math.exp(-0.5 * x) - 3 * x + 1,
                df: (x) => {
                    const ex = Math.exp(-0.5 * x);
                    return 3 * Math.pow(x, 2) - (2 * x * ex - 0.5 * Math.pow(x, 2) * ex) - 3;
                },
                graphRange: { min: -3, max: 3 },
                configs: [
                    { name: "Raíz Negativa", interval: [-2, -0.5], x0Newton: -2, x0Secant: -2.5, x1Secant: -2 },
                    { name: "Raíz Central", interval: [0.2, 0.5], x0Newton: 0.3, x0Secant: 0.2, x1Secant: 0.4 },
                    { name: "Raíz Positiva", interval: [1.2, 2.0], x0Newton: 1.5, x0Secant: 1.2, x1Secant: 2.0 }
                ]
            },
            {
                id: 4,
                title: "Ejercicio 4",
                equation: "cos²(x) - 0.5xe^(0.3x) + 5 = 0",
                description: "Trigonométrica y Exponencial",
                f: (x) => Math.pow(Math.cos(x), 2) - 0.5 * x * Math.exp(0.3 * x) + 5,
                df: (x) => -2 * Math.cos(x) * Math.sin(x) - 0.5 * (Math.exp(0.3 * x) + 0.3 * x * Math.exp(0.3 * x)),
                graphRange: { min: 0, max: 6 },
                configs: [
                    { name: "Raíz Única", interval: [3, 4], x0Newton: 3.5, x0Secant: 3, x1Secant: 4 }
                ]
            }
        ];

        // MÉTODOS NUMÉRICOS (SE MANTIENEN IDÉNTICOS)
        const bisection = (f, a, b, tol = 1e-5, maxIter = 100) => {
            const iterations = [];
            let fa = f(a), fb = f(b);
            if (fa * fb > 0) return { root: null, iterations, error: `Intervalo inválido: f(a)*f(b) > 0` };
            let iter = 0, c = 0, fc = 0;
            while (iter < maxIter) {
                c = (a + b) / 2; fc = f(c); const error = Math.abs(b - a);
                iterations.push({ iter: iter + 1, x: c, fx: fc, error: error });
                if (Math.abs(fc) < tol || error < tol) break;
                if (fa * fc < 0) { b = c; fb = fc; } else { a = c; fa = fc; }
                iter++;
            }
            return { root: c, iterations, converged: iter < maxIter };
        };

        const newtonRaphson = (f, df, x0, tol = 1e-5, maxIter = 100) => {
            const iterations = [];
            let x = x0, iter = 0;
            iterations.push({ iter: 0, x: x, fx: f(x), error: null });
            while (iter < maxIter) {
                const fx = f(x), dfx = df(x);
                if (Math.abs(dfx) < 1e-10) return { root: null, iterations, error: 'Derivada ≈ 0, posible punto de inflexión' };
                const xNew = x - fx / dfx; const error = Math.abs(xNew - x);
                iterations.push({ iter: iter + 1, x: xNew, fx: f(xNew), error: error });
                if (error < tol) { x = xNew; break; }
                x = xNew; iter++;
            }
            return { root: x, iterations, converged: iter < maxIter };
        };

        const secant = (f, x0, x1, tol = 1e-5, maxIter = 100) => {
            const iterations = [];
            let xPrev = x0, x = x1, iter = 0;
            iterations.push({ iter: 0, x: x1, fx: f(x1), error: Math.abs(x1-x0) });
            while (iter < maxIter) {
                const fPrev = f(xPrev), fx = f(x);
                if (Math.abs(fx - fPrev) < 1e-10) return { root: null, iterations, error: 'División por 0, f(x_k) ≈ f(x_k-1)' };
                const xNew = x - fx * (x - xPrev) / (fx - fPrev); const error = Math.abs(xNew - x);
                iterations.push({ iter: iter + 1, x: xNew, fx: f(xNew), error: error });
                if (error < tol) { x = xNew; break; }
                xPrev = x; x = xNew; iter++;
            }
            return { root: x, iterations, converged: iter < maxIter };
        };

        // --- INTERFAZ (REDiseñada) ---
        function init() { renderTabs(); renderControlPanel(); lucide.createIcons(); }

        function renderTabs() {
            document.getElementById('tabs-container').innerHTML = exercises.map((ex, idx) => `
                <button onclick="switchTab(${idx})" class="px-5 py-2.5 rounded-lg text-sm font-semibold transition-all duration-300 ${activeTab === idx ? 'active-tab-neon' : 'inactive-tab-neon'}">${ex.title}</button>
            `).join('');
        }

        function switchTab(idx) {
            activeTab = idx;
            document.getElementById('empty-state').classList.remove('hidden');
            document.getElementById('results-content').classList.add('hidden');
            renderTabs(); renderControlPanel();
        }

        function renderControlPanel() {
            const ex = exercises[activeTab];
            document.getElementById('ex-title').innerText = ex.title;
            document.getElementById('ex-equation').innerText = ex.equation;
            document.getElementById('ex-desc').innerText = ex.description;
            document.getElementById('configs-container').innerHTML = ex.configs.map((conf, i) => `
                <div class="text-xs bg-gray-900 p-4 rounded-lg border border-gray-800 relative group hover:border-[#00ff41] transition-colors shadow-lg shadow-gray-900/50">
                    <div class="absolute top-0 right-0 bg-[#00ff41] text-black px-2 py-1 rounded-bl-lg text-[10px] font-bold border-l border-b border-gray-800 shadow-md shadow-[#00ff41]/40">CONFIG ${i+1}</div>
                    <strong class="block text-white mb-2 text-sm flex items-center gap-2"><i data-lucide="zap" class="w-3.5 h-3.5 text-[#00ffff]"></i> ${conf.name}</strong>
                    <div class="grid grid-cols-1 gap-1.5 text-gray-400 font-mono">
                        <div class="flex justify-between border-b border-gray-800 pb-1"><span>Bisección:</span> <span class="font-bold text-[#00ff41]">[${conf.interval[0]}, ${conf.interval[1]}]</span></div>
                        <div class="flex justify-between border-b border-gray-800 pb-1"><span>Newton:</span> <span class="font-bold text-[#00ffff]">x₀ = ${conf.x0Newton}</span></div>
                        <div class="flex justify-between"><span>Secante:</span> <span class="font-bold text-[#ff00ff]">x₀=${conf.x0Secant}, x₁=${conf.x1Secant}</span></div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function calculateCurrent() {
            const btn = document.getElementById('btn-calculate');
            const originalText = btn.querySelector('.btn-text').innerText;
            const originalIcon = btn.querySelector('.btn-icon').innerHTML;
            
            btn.disabled = true;
            btn.querySelector('.btn-text').innerText = 'Analizando...';
            btn.querySelector('.btn-icon').innerHTML = '<i data-lucide="rotate-cw" class="animate-spin w-5 h-5 text-black"></i>';
            lucide.createIcons();

            // Oculta el mensaje de espera ANTES de calcular
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('results-content').classList.add('hidden');

            setTimeout(() => {
                const ex = exercises[activeTab];
                currentResults = ex.configs.map(config => ({
                    name: config.name,
                    bisection: bisection(ex.f, config.interval[0], config.interval[1]),
                    newtonRaphson: newtonRaphson(ex.f, ex.df, config.x0Newton),
                    secant: secant(ex.f, config.x0Secant, config.x1Secant),
                    config: config
                }));

                const graphPoints = [];
                const step = (ex.graphRange.max - ex.graphRange.min) / 100;
                for (let x = ex.graphRange.min; x <= ex.graphRange.max; x += step) graphPoints.push({ x: x, y: ex.f(x) });

                renderResults(currentResults, graphPoints);
                btn.disabled = false;
                btn.querySelector('.btn-text').innerText = originalText;
                btn.querySelector('.btn-icon').setAttribute('data-lucide', 'cpu');
                lucide.createIcons();
            }, 500);
        }

        function renderResults(roots, graphData) {
            document.getElementById('empty-state').classList.add('hidden');
            // Muestra el contenedor de resultados
            document.getElementById('results-content').classList.remove('hidden');
            
            renderChart(graphData, roots);

            document.getElementById('cards-container').innerHTML = roots.map((r, i) => {
                // Lógica del GANADOR (Menos iteraciones y que haya encontrado raíz)
                const methods = [
                    { key: 'bisection', count: r.bisection.iterations.length, valid: r.bisection.root !== null },
                    { key: 'newtonRaphson', count: r.newtonRaphson.iterations.length, valid: r.newtonRaphson.root !== null },
                    { key: 'secant', count: r.secant.iterations.length, valid: r.secant.root !== null }
                ];
                
                const validMethods = methods.filter(m => m.valid);
                const minIter = validMethods.length > 0 ? Math.min(...validMethods.map(m => m.count)) : -1;

                // Función auxiliar para saber si es el mejor
                const isBest = (key) => {
                    const m = methods.find(x => x.key === key);
                    return m.valid && m.count === minIter;
                };

                return `
                <div class="card-neon rounded-xl overflow-hidden ${isBest('newtonRaphson') || isBest('bisection') || isBest('secant') ? 'best-method-card' : 'border border-gray-800 shadow-green-900/10'} slide-in" style="animation-delay: ${i * 0.1}s">
                    <div class="bg-gray-800/50 px-6 py-4 border-b border-gray-800 flex flex-wrap justify-between items-center gap-3">
                        <div class="flex items-center gap-3">
                            <span class="flex items-center justify-center w-8 h-8 rounded-full bg-[#00ff41] text-black font-bold text-sm shadow-md shadow-[#00ff41]/40">${i + 1}</span>
                            <h3 class="font-bold text-white text-xl">${r.name}</h3>
                        </div>
                        <span class="text-sm font-mono bg-green-900/50 text-green-400 border border-green-700 px-3 py-1 rounded-full font-bold shadow-inner">
                            Raíz Aprox: ${r.newtonRaphson.root ? r.newtonRaphson.root.toFixed(6) : "..."}
                        </span>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                        ${renderMethodCard("Bisección", r.bisection, "text-[#00ff41]", "bg-gray-900/50 border-[#00ff41]/30", "from-[#00ff41] to-[#00ffff]", i, "bisection", isBest('bisection'))}
                        ${renderMethodCard("Newton-Raphson", r.newtonRaphson, "text-[#00ffff]", "bg-gray-900/50 border-[#00ffff]/30", "from-[#00ffff] to-[#ff00ff]", i, "newtonRaphson", isBest('newtonRaphson'))}
                        ${renderMethodCard("Secante", r.secant, "text-[#ff00ff]", "bg-gray-900/50 border-[#ff00ff]/30", "from-[#ff00ff] to-[#00ff41]", i, "secant", isBest('secant'))}
                    </div>
                </div>
                `.replace(/\s{2,}/g, ' ', '').trim(); // Limpieza para mayor legibilidad
            }).join('');
            lucide.createIcons();
        }

        function renderMethodCard(title, data, colorText, bgClasses, btnGradient, rootIndex, methodKey, isBest) {
            if (data.root === null) {
                return `
                <div class="rounded-lg p-5 border bg-red-900/50 border-red-800 text-center flex flex-col justify-center h-full shadow-inner">
                    <h4 class="font-bold text-sm uppercase tracking-wide text-red-400 mb-2">${title}</h4>
                    <p class="text-xs text-red-500 font-medium">ERROR: ${data.error}</p>
                </div>`;
            }

            // Clases dinámicas si es el mejor (Efecto Neón)
            const borderClass = isBest ? 'best-method-card' : `${bgClasses} hover:border-[#00ff41]`;
            const badgeHTML = isBest ? '<span class="absolute -top-3 left-1/2 transform -translate-x-1/2 best-badge-neon text-[10px] uppercase font-bold px-3 py-1 rounded-full shadow-xl z-10 tracking-wider">ÓPTIMO</span>' : '';

            return `
            <div class="rounded-lg p-5 border ${borderClass} transition-all duration-300 flex flex-col relative group h-full bg-gray-900 shadow-inner">
                ${badgeHTML}
                <div class="flex justify-between items-start mb-4 ${isBest ? 'mt-2' : ''}">
                    <h4 class="font-bold text-xs uppercase tracking-wide ${colorText}">${title}</h4>
                    <span class="text-[10px] font-bold bg-gray-700 text-gray-300 px-2 py-0.5 rounded-md shadow-sm border border-gray-600">${data.iterations.length} Iters</span>
                </div>
                
                <div class="text-center mb-4 flex-grow">
                    <p class="text-3xl font-mono font-bold text-white tracking-tighter highlight-neon-gradient">${data.root.toFixed(7)}</p>
                    <p class="text-[10px] text-gray-500 mt-1">|f(x)|: ${Math.abs(data.iterations[data.iterations.length-1].fx).toExponential(2)}</p>
                    <p class="text-[10px] text-gray-500">Error: ${data.iterations[data.iterations.length-1].error ? data.iterations[data.iterations.length-1].error.toExponential(2) : '0'}</p>
                </div>

                <button onclick="openTableModal(${rootIndex}, '${methodKey}', '${title}')" 
                    class="w-full mt-auto py-2 rounded-md bg-gray-700 border border-gray-600 text-xs font-bold text-gray-300 shadow-md hover:text-black hover:bg-gradient-to-r hover:${btnGradient} hover:border-transparent transition-all flex items-center justify-center gap-2">
                    <i data-lucide="table-2" class="w-3.5 h-3.5"></i> Ver Iteraciones
                </button>
            </div>`.replace(/\s{2,}/g, ' ', '').trim();
        }

        // --- MODAL & GRÁFICA (Estilos adaptados a Neón) ---
        function openTableModal(idx, key, title) {
            const data = currentResults[idx][key];
            const ex = exercises[activeTab];
            document.getElementById('modal-title').innerText = `Tabla de Iteraciones: ${title}`;
            document.getElementById('modal-subtitle').innerText = `(${ex.title} | ${ex.equation}) Total: ${data.iterations.length} iteraciones`;
            document.getElementById('modal-table-body').innerHTML = data.iterations.map(r => `
                <tr class="hover:bg-gray-800/50">
                    <td class="px-4 py-2 font-bold text-gray-300 border-r border-gray-800">${r.iter}</td>
                    <td class="px-4 py-2 text-[#00ff41]">${r.x.toFixed(8)}</td>
                    <td class="px-4 py-2 text-gray-400">${r.fx.toExponential(4)}</td>
                    <td class="px-4 py-2 text-[#ff00ff] text-xs">${r.error !== null ? r.error.toExponential(4) : '-'}</td>
                </tr>
            `).join('');
            const modal = document.getElementById('table-modal');
            modal.classList.remove('hidden');
            setTimeout(() => { modal.querySelector('.transform').classList.remove('scale-95', 'opacity-0'); }, 10);
        }

        function closeModal() {
            const m = document.getElementById('table-modal');
            m.querySelector('.transform').classList.add('scale-95', 'opacity-0');
            setTimeout(() => m.classList.add('hidden'), 200);
        }

        function renderChart(dataPoints, roots) {
            const ctx = document.getElementById('myChart');
            if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
            const rootPoints = roots.filter(r => r.newtonRaphson.root !== null && !isNaN(r.newtonRaphson.root)).map(r => ({ x: r.newtonRaphson.root, y: 0 }));

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        { label: 'Función f(x)', data: dataPoints, borderColor: '#facc15', borderWidth: 3, pointRadius: 0, tension: 0.4 }, // Amarillo para la función (Neón)
                        { label: 'Raíces', data: rootPoints, backgroundColor: '#ef4444', pointRadius: 7, type: 'scatter', hoverRadius: 9 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'nearest', axis: 'x', intersect: false },
                    scales: {
                        x: { 
                            type: 'linear', position: 'bottom', 
                            grid: { color: '#334155' }, // Color de rejilla oscuro
                            title: { display: true, text: 'X', color: '#00ff41' }, // Neón Verde
                            ticks: { color: '#e2e8f0' } // Color de las etiquetas
                        },
                        y: { 
                            grid: { color: '#334155' }, 
                            title: { display: true, text: 'f(x)', color: '#00ff41' }, // Neón Verde
                            ticks: { color: '#e2e8f0' }
                        }
                    },
                    plugins: { 
                        tooltip: { 
                            backgroundColor: '#1a1a1a', 
                            titleColor: '#00ffff', // Cian Neón
                            bodyColor: '#e2e8f0',
                            padding: 10, cornerRadius: 8,
                            borderColor: '#00ff41',
                            borderWidth: 1
                        },
                        legend: {
                            labels: {
                                color: '#e2e8f0' // Color de las leyendas
                            }
                        }
                    }
                }
            });
        }

        init();
        document.addEventListener('keydown', (e) => { if (e.key === "Escape") closeModal(); });
    </script>
</body>
</html>